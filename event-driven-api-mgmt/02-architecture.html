<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Solution Pattern: Event Driven API Management :: Solution Patterns from Red Hat</title>
    <link rel="canonical" href="https://redhat-solution-patterns.github.io/solution-patterns/event-driven-api-mgmt/02-architecture.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="03-demo.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-21PT8RV6BR"></script>
<script>function gtag() { dataLayer.push(arguments) }; window.dataLayer = window.dataLayer || []; gtag('js', new Date()); gtag('config', 'G-21PT8RV6BR')</script>
  </head>
  <body class="article">
<!-- Google tag (gtag.js) -->

<!-- 
  replace this with Google tag content 
-->

<!-- Google tag (gtag.js) -->
<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
      const urlParams = new URLSearchParams(window.location.search);
      const userId = urlParams.get('USERID');
      const subdomain = urlParams.get('SUBDOMAIN');
      if (userId) {
        showUserId(userId, subdomain);
      }
      else {
        showUserIdForm(subdomain);
      }
    });


    function showUserId(userId, subdomain) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('userIdDisplay').textContent = "User ID : " + userId;
      document.getElementById('subdomainDisplay').textContent = "Subdomain : " + subdomain;
    }

    function showUserIdForm(subdomain) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
      document.getElementById('subdomain').value = subdomain;

    }

    function goWithUserId() {
      elUserIdInput = document.getElementById('userId');
      elSubdomainInput = document.getElementById('subdomain');
      window.location.search = ('&USERID=' + elUserIdInput.value + '&SUBDOMAIN=' + elSubdomainInput.value);
    }

    function recycle() {
      document.getElementById('userId').value = '';
      document.getElementById('subdomain').value = '';
      window.location.search = ('');
    }
  </script>

  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" style="font-size: 20px; color: white"
        href="https://redhat-solution-patterns.github.io/solution-patterns">
        <img src="../_/img/logo.png" height="35px" alt="Solution Patterns">&nbsp; Solution Patterns from Red Hat</a>
      <button class="navbar-burger" data-target="topbar-nav">
      </button>
    </div>
    
    <div class="navbar-item"><span class="navbar-text"
        style="color: white; margin-left: 1rem; margin-right: 1rem;">|</span></div>

    <div class="navbar-item has-dropdown is-hoverable">
      <a class="navbar-link" href="#" style="color: white">Architectures &amp; Patterns</a>
      <div class="navbar-dropdown">
        <a class="navbar-item" href="https://www.redhat.com/architect/portfolio/" target="_blank">Portfolio Architecture&nbsp; </a>
        <a class="navbar-item" href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html" target="_blank">Solution Patterns </a>
        <a class="navbar-item" href="https://validatedpatterns.io/" target="_blank">Validated Patterns&nbsp;</a>
        <a class="navbar-item" href="https://catalog.redhat.com/solutions" target="_blank">Ecosystem Solutions&nbsp;</a>
      </div>
    </div>

    <div class="navbar-item has-dropdown is-hoverable">
      <a class="navbar-link" href="#" style="color: white">Resources</a>
      <div class="navbar-dropdown">
        <a class="navbar-item" target="_blank" href="https://developers.redhat.com">Red Hat Developers</a>
        <a class="navbar-item" target="_blank" href="https://developers.redhat.com/app-dev-platform">App Dev Platform</a>
        <a class="navbar-item" target="_blank" href="https://www.redhat.com/en/products/application-foundations">Red Hat Application Services</a>
      </div>
    </div>



    <a class="navbar-item" style="color: white" target="_blank" href="https://github.com/redhat-solution-patterns/redhat-solution-patterns.github.io/issues">Feedback</a>

    <a class="navbar-item" style="color: white" target="_blank" href="https://redhat-solution-patterns.github.io/solution-patterns/contributors-guide.html">Contribute</a>

    <div class="navbar-item"><span class="navbar-text"
        style="color: white; margin-left: 1rem; margin-right: 1rem;">|</span></div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" id="navbar-form-empty">
          <span class="navbar-text" style="margin-left: 2rem;">
            <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
                class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>
                Your Workshop Environment
            <form action="javascript:void(0);" onsu>
              <input size="20" id="userId" type="text" placeholder="USER ID">
              <input size="20" id="subdomain" type="text" placeholder="Subdomain">
              <button type="hidden" onclick="goWithUserId();">Set</button>
            </form>
        </div>

        <div class="navbar-item" id="navbar-form-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 2rem;">
            <span class="navbar-text " style="margin-left: 1rem; margin-right: 1rem; float:left">
              &nbsp;Your Workshop Environment 
              <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">
                  &nbsp;<i alt="Clear details" title="Clear details" onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i>
                <br>
                <span id="userIdDisplay"></span> 
                <span style="color: white; margin-left: 1rem; margin-right: 1rem;">|</span>
                <span id="subdomainDisplay"></span>
              </span>
            </span>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="event-driven-api-mgmt" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Event Driven API Management</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#use-cases">1.1 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_story_behind_this_solution_pattern">1.2 The story behind this solution pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_solution">1.3 The solution</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tech_stack">2.1. Common Challenges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tech_stack">2.2. Technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#in_depth">2.3. An in-depth look at the solution&#8217;s architecture</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html">3. See the Solution in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-demo.html#_demonstration">3.1. Setup the solution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html#_run_the_demonstration">3.2. Workshop Walkthrough guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-demo.html#_before_getting_started">3.3. Conclusion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="developer-resources.html">4. Developer Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html" target="_blank" rel="noopener">Explore Red Hat Solution Patterns</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Event Driven API Management</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Event Driven API Management</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Event Driven API Management</a></li>
    <li><a href="02-architecture.html">2. Architecture</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/abdelhamidfg/solution-pattern-event-driven-api-mgmt/edit/main/documentation/modules/ROOT/pages/02-architecture.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Solution Pattern: Event Driven API Management</h1>
<h1 id="_architecture" class="sect0"><a class="anchor" href="#_architecture"></a><a class="link" href="#_architecture">Architecture</a></h1>
<div class="sect1">
<h2 id="_common_challenges"><a class="anchor" href="#_common_challenges"></a><a class="link" href="#_common_challenges">1. Common Challenges</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The architecture  team has identified a set of non-functional requirements for building a reliable webhook delivery system:-</p>
</div>
<div class="sect2">
<h3 id="_security"><a class="anchor" href="#_security"></a><a class="link" href="#_security">1.1. Security:</a></h3>
<div class="paragraph">
<p>Webhook messages are sent to the consumers public URLs that can be accessed by any unauthorized person. API consumers cannot verify that they are receiving a webhook from a trusted API provider. Therefore, we need an authentication strategy to trust the incoming webhook notifications. One of the most secure approaches is to use a <strong>Webhook Signature</strong>, which works by :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A secret key is known by both the webhook producer(webhook delivery system) and consumer.</p>
</li>
<li>
<p>The webhook producer uses this key with a cryptographic algorithm like HMAC SHA-256 to create a signature of the webhook payload, which is sent in the header along with the webhook request.</p>
</li>
<li>
<p>When receiving the webhook request, the webhook consumer will perform the same signing approach and compare the result with the request signature header.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In addition to the authentication approach, we require that all consumer webhook endpoint URLs use HTTPS to ensure privacy and data integrity.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scalability_and_performance"><a class="anchor" href="#_scalability_and_performance"></a><a class="link" href="#_scalability_and_performance">1.2. Scalability and performance:</a></h3>
<div class="ulist">
<ul>
<li>
<p>The Webhook delivery system must be able to manage a growing number of webhooks and handle high throughput of messages by using horizontal scaling resources up or down as needed .</p>
</li>
<li>
<p>For cost efficiency and resource optimization <strong>scaling to zero</strong> is required which is a key feature of <strong>serverless</strong> computing architectures, where application components can automatically scale down to zero instances when not in use.</p>
</li>
<li>
<p>The Webhook delivery system must be optimized for fast message processing and delivery to meet real-time or near-real-time requirements.</p>
</li>
<li>
<p>The Webhook delivery system must use a caching component for caching any required remote calls for better performance and throughput.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_support_of_retry"><a class="anchor" href="#_support_of_retry"></a><a class="link" href="#_support_of_retry">1.3. Support of Retry:</a></h3>
<div class="paragraph">
<p>The webhook delivery system must manage the retry of failed messages  (e.g., due to the consumer receiving server being down or returning any response other than 2xx)  by applying exponential backoff policy to avoid overwhelming the receiving consumer server.</p>
</div>
<div class="paragraph">
<p>This policy increases the interval between retry attempts exponentially, which helps to avoid overwhelming the destination consumer during outages and provides a more efficient approach to managing retries over time.</p>
</div>
<div class="paragraph">
<p>The equation to calculate exponential back off retries :-
{interval} + {retry_count} ^ 4</p>
</div>
<div class="paragraph">
<p>For example, if you configure the maximum retry attempts to 5 and the interval to 60 seconds, the calculated intervals for every retry would be as below table :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Retry Count</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Next Retry in seconds</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Total Seconds Elapsed</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="literalblock">
<div class="content">
<pre>1
2
3
4
5</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="literalblock">
<div class="content">
<pre>61
76
141
361
685</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="literalblock">
<div class="content">
<pre>61
137
278
594
1,279</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When all retry attempts fail, the system shall use a dead-letter queue for undeliverable messages.</p>
</div>
<div class="paragraph">
<p>The retry requirements necessitate a message broker with the capability of persistently scheduling messages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_avoiding_duplicate_messages"><a class="anchor" href="#_avoiding_duplicate_messages"></a><a class="link" href="#_avoiding_duplicate_messages">1.4. Avoiding duplicate messages:</a></h3>
<div class="paragraph">
<p>Since webhook messages may be delivered more than once, which may cause unexpected behavior in consumer applications, the most common approach to avoid this is by using a unique idempotency key for each event (e.g., in the order-created event, the order id can be used). This allows the consumer to track processed keys and avoid reprocessing duplicates using the idempotent consumer pattern.</p>
</div>
</div>
<div class="sect2">
<h3 id="_api_management_requirements"><a class="anchor" href="#_api_management_requirements"></a><a class="link" href="#_api_management_requirements">1.5. API Management requirements:</a></h3>
<div class="paragraph">
<p>The business team has  the following requirements related to API Management:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide different subscription plans for the order-created event. The free plan  does not require any payment and has a limitation of 100 webhook notifications per hour, while the paid plan offers an unlimited number of webhook notifications with monthly subscription fees.</p>
</li>
<li>
<p>Monitor and analyze consumer webhook usage patterns to identify clients that exceed their rate limits.</p>
</li>
<li>
<p>Socialize event-driven APIs through a developer portal, showing the structure of the webhook message using OpenAPI specification.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_other_requirements"><a class="anchor" href="#_other_requirements"></a><a class="link" href="#_other_requirements">1.6. Other requirements:</a></h3>
<div class="ulist">
<ul>
<li>
<p>The webhook delivery system should be deployed as cloud-native microservices.</p>
</li>
<li>
<p>The webhook delivery system should use cloud-native configuration management for effectively managing settings, parameters, and policies.</p>
</li>
<li>
<p>The webhook delivery system should have the capability of integration with different message brokers, caching components and 3scale API Management REST API.</p>
</li>
<li>
<p>The webhook delivery system should be configured to work with any Kafka topic and support payloads in multiple formats, such as JSON, XML, and Avro. It should also be provisined and configured with any event-driven 3scale API product.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tech_stack"><a class="anchor" href="#tech_stack"></a><a class="link" href="#tech_stack">2. Technology Stack</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.redhat.com/en/products/application-foundations">Red Hat Application Foundations</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://developers.redhat.com/products/3scale/overview">Red Hat 3scale API Management</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/products/streams-for-apache-kafka/">Red Hat Streams For Apache Kafka</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/products/red-hat-amq#broker">Red Hat AMQ Broker</a></p>
</li>
<li>
<p><a href="https://developers.redhat.com/products/redhat-build-of-apache-camel/overview">Red Hat build of Apache Camel</a></p>
</li>
<li>
<p><a href="https://developers.redhat.com/products/red-hat-data-grid/overview">Red Hat Data Grid</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.redhat.com/en/technologies/cloud-computing/openshift">Red Hat OpenShift</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="in_depth"><a class="anchor" href="#in_depth"></a><a class="link" href="#in_depth">3. An in-depth look at the solution&#8217;s architecture</a></h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="_images/architecture-2x.png" alt="architecture 2x" width="100%">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>API consumers subscribe to an application plan of the order-created event API product through the developer portal, providing their webhook endpoint. Upon successful subscription, the API consumer will receive a MAC secret that can be used for authenticating incoming webhook callbacks.</p>
</li>
<li>
<p>The <strong>Webhook Creator microservice</strong> listens to the “order-created-event” topic in the kafka cluster and produces multiple webhook requests for each subscribed consumer application in the API product by using the 3scale Admin REST API. Each webhook request will be inserted in the “webhookQueue” queue in AMQ broker for each webhook consumer which contains the payload of the kafka message and other header parameters like consumer webhook endpoint, the retry count and MAC secret.</p>
</li>
<li>
<p>The <strong>Webhook Dispatcher microservice</strong> listens to the “webhookQueue” queue in AMQ broker cluster and creates an HTTP request to the 3scale  API gateway containing the payload of the webhook. It is also responsible for implementing the retry mechanism for the failed messages using exponential backoff policy.</p>
</li>
<li>
<p>When the request comes in the API gateway, a custom policy will calculate the HMAC signature  header and route webhook messages to the consumer’s webhook endpoint.</p>
</li>
<li>
<p>The consumer webhook receives the request, validates the HMAC header using the shared MAC secret through the developer portal, and processes the message accordingly.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The API Gateway is used as the single point of egress for the external traffic to secure , route , impose rate limits ,monetize and monitor webhooks calls from the API provider to the consumer webhooks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_architectural_design_decisions"><a class="anchor" href="#_architectural_design_decisions"></a><a class="link" href="#_architectural_design_decisions">3.1. Architectural design decisions</a></h3>
<div class="paragraph">
<p>The below section describes the architectural design decisions that helped Globex team for achieving non-functional requirements</p>
</div>
<div class="sect3">
<h4 id="_implementation_framework"><a class="anchor" href="#_implementation_framework"></a><a class="link" href="#_implementation_framework">3.1.1. Implementation Framework</a></h4>
<div class="paragraph">
<p><strong>Camel Quarkus</strong> is the implementation framework for the webhook delivery components, which is a framework that combines the capabilities of Apache Camel and Quarkus to facilitate the integration and development of microservices and cloud-native applications. It leverages the strengths of both platforms to provide a highly efficient runtime for integration tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="_security_2"><a class="anchor" href="#_security_2"></a><a class="link" href="#_security_2">3.1.2. Security</a></h4>
<div class="paragraph">
<p><strong>HMAC SHA-256</strong>  algorthim is chosen as an authentication method for webhook consumers to trust the incoming webhook notifications, which  is a cryptographic hash function for ensuring data integrity and authenticity.
The 3scale custom policy is used to calculate HMAC header using the <a href="https://docs.redhat.com/en/documentation/red_hat_3scale_api_management/2.14/html/administering_the_api_gateway/apicast-policies#camel-service_standard-policies">Camel service policy extension</a>  implemented using Camel Quarkus.</p>
</div>
</div>
<div class="sect3">
<h4 id="_scalability"><a class="anchor" href="#_scalability"></a><a class="link" href="#_scalability">3.1.3. Scalability</a></h4>
<div class="paragraph">
<p><a href="https://docs.openshift.com/container-platform/4.14/nodes/cma/nodes-cma-autoscaling-custom-install.html">KEDA</a> (Kubernetes Event-Driven Autoscaling) is chosen for scaling the webhook creator and dispatcher services.
KEDA facilitates more efficient resource usage in Kubernetes environments by allowing services to scale based on actual demand driven by events.</p>
</div>
<div class="paragraph">
<p>The webhook creator service is scaled using the number of the messages on “order-created-event” kafka topic. The Maximum number of replica that can be achieved  is equal to the number of partitions you have in the kafka topic "order-created-event". This limitation is related to kafka principles where each partition in a Kafka topic can be consumed by only one consumer in a consumer group at any given time.
The webhook Dispatcher service is scaled using the number of messages on AMQ Broker queue “webhookQueue”.</p>
</div>
<div class="paragraph">
<p>The architecture team has chosen <strong>AMQ Broker over Kafka</strong> for the dispatcher service, as it is specifically optimized for low-latency message delivery. Unlike Kafka, AMQ Broker does not face limitations with concurrent consumers; it can dynamically scale to an unlimited number of dispatcher instances, thus enhancing throughput and reducing latency.</p>
</div>
<div class="paragraph">
<p>Webhook Creator and Dispatcher services are implemented using Camel Quarkus which allows integration with KEDA using traits with the ability to define scaling to zero rules.</p>
</div>
<div class="paragraph">
<p>Data Grid cache is used in the webhook creator service to cache consumer applications from 3scale API for better scalability and performance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_retry_policy"><a class="anchor" href="#_retry_policy"></a><a class="link" href="#_retry_policy">3.1.4. Retry policy</a></h4>
<div class="paragraph">
<p>The Dispatcher service uses an exponential backoff policy allowing the DevOps team to manage configuration parameters of the policy in OpenShift using secrets.
AMQ Broker delayed message feature is used to schedule the retry of failed webhook delivery.</p>
</div>
</div>
<div class="sect3">
<h4 id="_avoiding_duplicate_messages_2"><a class="anchor" href="#_avoiding_duplicate_messages_2"></a><a class="link" href="#_avoiding_duplicate_messages_2">3.1.5. Avoiding duplicate messages</a></h4>
<div class="paragraph">
<p>The webhook creator service uses <a href="https://camel.apache.org/components/4.4.x/eips/idempotentConsumer-eip.html">Idempotent consumer EIP</a> to filter out the duplicate messages using the infinispan/Data Grid repository for better scalability.
In the case of order-created event, the idempotent key is the order Id which is communicated by the producers as a kafka message header “idempotentKey” rather than in the message body to allow the webhook delivery system to be payload agnostic.</p>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html" class="query-params-link">1. Home page</a></span>
  <span class="next"><a href="03-demo.html" class="query-params-link">3. See the Solution in Action</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer" style="justify-content: center;">
  <div>
    <img src="./_images/red_hat_logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns" href="https://redhat.com">
  </div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
