<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Solution Pattern: Event Driven API Management :: Solution Patterns from Red Hat</title>
    <link rel="canonical" href="https://redhat-solution-patterns.github.io/solution-patterns/event-driven-api-mgmt/03-demo.html">
    <link rel="prev" href="02-architecture.html">
    <link rel="next" href="developer-resources.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-21PT8RV6BR"></script>
<script>function gtag() { dataLayer.push(arguments) }; window.dataLayer = window.dataLayer || []; gtag('js', new Date()); gtag('config', 'G-21PT8RV6BR')</script>
  </head>
  <body class="article">
<!-- Google tag (gtag.js) -->

<!-- 
  replace this with Google tag content 
-->

<!-- Google tag (gtag.js) -->
<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
      const urlParams = new URLSearchParams(window.location.search);
      const userId = urlParams.get('USERID');
      const subdomain = urlParams.get('SUBDOMAIN');
      if (userId) {
        showUserId(userId, subdomain);
      }
      else {
        showUserIdForm(subdomain);
      }
    });


    function showUserId(userId, subdomain) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('userIdDisplay').textContent = "User ID : " + userId;
      document.getElementById('subdomainDisplay').textContent = "Subdomain : " + subdomain;
    }

    function showUserIdForm(subdomain) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
      document.getElementById('subdomain').value = subdomain;

    }

    function goWithUserId() {
      elUserIdInput = document.getElementById('userId');
      elSubdomainInput = document.getElementById('subdomain');
      window.location.search = ('&USERID=' + elUserIdInput.value + '&SUBDOMAIN=' + elSubdomainInput.value);
    }

    function recycle() {
      document.getElementById('userId').value = '';
      document.getElementById('subdomain').value = '';
      window.location.search = ('');
    }
  </script>

  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" style="font-size: 20px; color: white"
        href="https://redhat-solution-patterns.github.io/solution-patterns">
        <img src="../_/img/logo.png" height="35px" alt="Solution Patterns">&nbsp; Solution Patterns from Red Hat</a>
      <button class="navbar-burger" data-target="topbar-nav">
      </button>
    </div>
    
    <div class="navbar-item"><span class="navbar-text"
        style="color: white; margin-left: 1rem; margin-right: 1rem;">|</span></div>

    <div class="navbar-item has-dropdown is-hoverable">
      <a class="navbar-link" href="#" style="color: white">Architectures &amp; Patterns</a>
      <div class="navbar-dropdown">
        <a class="navbar-item" href="https://www.redhat.com/architect/portfolio/" target="_blank">Portfolio Architecture&nbsp; </a>
        <a class="navbar-item" href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html" target="_blank">Solution Patterns </a>
        <a class="navbar-item" href="https://validatedpatterns.io/" target="_blank">Validated Patterns&nbsp;</a>
        <a class="navbar-item" href="https://catalog.redhat.com/solutions" target="_blank">Ecosystem Solutions&nbsp;</a>
      </div>
    </div>

    <div class="navbar-item has-dropdown is-hoverable">
      <a class="navbar-link" href="#" style="color: white">Resources</a>
      <div class="navbar-dropdown">
        <a class="navbar-item" target="_blank" href="https://developers.redhat.com">Red Hat Developers</a>
        <a class="navbar-item" target="_blank" href="https://developers.redhat.com/app-dev-platform">App Dev Platform</a>
        <a class="navbar-item" target="_blank" href="https://www.redhat.com/en/products/application-foundations">Red Hat Application Services</a>
      </div>
    </div>



    <a class="navbar-item" style="color: white" target="_blank" href="https://github.com/redhat-solution-patterns/redhat-solution-patterns.github.io/issues">Feedback</a>

    <a class="navbar-item" style="color: white" target="_blank" href="https://redhat-solution-patterns.github.io/solution-patterns/contributors-guide.html">Contribute</a>

    <div class="navbar-item"><span class="navbar-text"
        style="color: white; margin-left: 1rem; margin-right: 1rem;">|</span></div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" id="navbar-form-empty">
          <span class="navbar-text" style="margin-left: 2rem;">
            <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
                class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>
                Your Workshop Environment
            <form action="javascript:void(0);" onsu>
              <input size="20" id="userId" type="text" placeholder="USER ID">
              <input size="20" id="subdomain" type="text" placeholder="Subdomain">
              <button type="hidden" onclick="goWithUserId();">Set</button>
            </form>
        </div>

        <div class="navbar-item" id="navbar-form-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 2rem;">
            <span class="navbar-text " style="margin-left: 1rem; margin-right: 1rem; float:left">
              &nbsp;Your Workshop Environment 
              <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">
                  &nbsp;<i alt="Clear details" title="Clear details" onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i>
                <br>
                <span id="userIdDisplay"></span> 
                <span style="color: white; margin-left: 1rem; margin-right: 1rem;">|</span>
                <span id="subdomainDisplay"></span>
              </span>
            </span>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="event-driven-api-mgmt" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Event Driven API Management</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#use-cases">1.1 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_story_behind_this_solution_pattern">1.2 The story behind this solution pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_solution">1.3 The solution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#tech_stack">2.1. Common Challenges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#tech_stack">2.2. Technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#in_depth">2.3. An in-depth look at the solution&#8217;s architecture</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html">3. See the Solution in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_demonstration">3.1. Setup the solution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#_run_the_demonstration">3.2. Workshop Walkthrough guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_before_getting_started">3.3. Conclusion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="developer-resources.html">4. Developer Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html" target="_blank" rel="noopener">Explore Red Hat Solution Patterns</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Event Driven API Management</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Event Driven API Management</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Event Driven API Management</a></li>
    <li><a href="03-demo.html">3. See the Solution in Action</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/abdelhamidfg/solution-pattern-event-driven-api-mgmt/edit/main/documentation/modules/ROOT/pages/03-demo.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Solution Pattern: Event Driven API Management</h1>
<h1 id="_see_the_solution_in_action" class="sect0"><a class="anchor" href="#_see_the_solution_in_action"></a><a class="link" href="#_see_the_solution_in_action">See the Solution in Action</a></h1>
<div class="sect1">
<h2 id="_setup_the_solution"><a class="anchor" href="#_setup_the_solution"></a><a class="link" href="#_setup_the_solution">1. Setup the solution</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To provision the demo you will perform the following steps :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gain access to Red Hat OpenShift.This solution pattern has been tested on OpenShift 4.14</p>
</li>
<li>
<p>Ensure you have the tools oc and other pre-requisites tools in your local linux based environment such as your laptop</p>
</li>
<li>
<p>Access the OpenShift cluster with cluster-admin privileges</p>
</li>
<li>
<p>Log in to OpenShift with cluster-admin role via cli</p>
</li>
<li>
<p>Run the installation script to deploy the Solution Pattern in your OpenShift cluster</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a><a class="link" href="#_pre_requisites">1.1. Pre-requisites</a></h3>
<div class="paragraph">
<p>Here is the list of tools you need in your local environment so that you can use the automated installation:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.15/cli_reference/openshift_cli/getting-started-cli.html">OpenShift CLI (oc client)</a></p>
</li>
<li>
<p><a href="https://github.com/mikefarah/yq" target="_blank" rel="noopener">yq</a></p>
</li>
<li>
<p><a href="https://github.com/jqlang/jq" target="_blank" rel="noopener">jq</a></p>
</li>
<li>
<p><a href="https://podman.io/docs/installation" target="_blank" rel="noopener">podman</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Openshift RWX storage class is required for <a href="https://access.redhat.com/articles/2798521">3scale System6</a> FileStorage.</p>
</div>
<div class="paragraph">
<p>To check if you have the CLI tools, you can open your terminal and use the following commands:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-adoc hljs" data-lang="adoc">oc version #openshift cli client
jq –version
yq –version
podman –version</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_demo"><a class="anchor" href="#_installing_the_demo"></a><a class="link" href="#_installing_the_demo">1.2. Installing the demo</a></h3>
<div class="ulist">
<ul>
<li>
<p>Login to your OpenShift cluster as cluster-admin (because a number of operators will need to be installed)</p>
</li>
<li>
<p>Click on the username on the top right hand, and then click on Copy login command. This will open another tab and you will need to login again</p>
</li>
<li>
<p>Click on Display token link, and copy the command under Log in with this token. This will look like this</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">oc login --token=&lt;token&gt; --server=&lt;server&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the scripts as follows in an appropriate folder in your local enviroment</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-adoc hljs" data-lang="adoc">git clone https://github.com/rh-soln-pattern-event-driven-api/infra</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the following command to start the installation and replace the variable with your openshift RWX storage class</p>
</li>
</ul>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-adoc hljs" data-lang="adoc">./install-all.sh &lt;&lt;RWX-StorageClass&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following output is generated by executing the installation command provided above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> Deployment of Webhook delivery system has been completed.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_personalize_the_instructions"><a class="anchor" href="#_personalize_the_instructions"></a><a class="link" href="#_personalize_the_instructions">1.3. Personalize the instructions</a></h3>
<div class="paragraph">
<p>To personalize the rest of the instructions to your OpenShift environment,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At the top-right of this page enter</p>
<div class="ulist">
<ul>
<li>
<p><strong>subdomain</strong> to match your OpenShift cluster under the <strong>Your Workshop Environment</strong> section</p>
</li>
</ul>
</div>
</li>
<li>
<p>Press enter or click on the Set button</p>
<div class="imageblock">
<div class="content">
<img src="_images/setup-instructions.png" alt="setup instructions">
</div>
</div>
</li>
<li>
<p>The menubar and the rest of this walkthrough guide will be updated with the username and subdomain as shown below</p>
<div class="imageblock">
<div class="content">
<img src="_images/setup-instructions-complete.png" alt="setup instructions complete">
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The subdomain would look something like this <code>apps.cluster-name.guid.subdomain.myopenshift.com</code></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_workshop_walkthrough_guide"><a class="anchor" href="#_workshop_walkthrough_guide"></a><a class="link" href="#_workshop_walkthrough_guide">2. Workshop Walkthrough guide</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_explore_the_environment"><a class="anchor" href="#_explore_the_environment"></a><a class="link" href="#_explore_the_environment">2.1. Explore the environment</a></h3>
<div class="paragraph">
<p>Let’s walk through an overview of the components that have been setup already</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Launch the <a href="https://console-openshift-console.%SUBDOMAIN%" target="console">OpenShift console</a> and login</p>
</li>
<li>
<p>Review  installed components in each namespace as in the below table and animated image</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. A installed components</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Namespace</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Components</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="literalblock">
<div class="content">
<pre>webhook-system-3scale</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Red Hat 3scale operator</p>
</li>
<li>
<p>3scale API Manager instance</p>
</li>
<li>
<p>3scale objects CRDs for order-created-event API Product (product,backend,activedoc,..)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="literalblock">
<div class="content">
<pre>webhook-system-amq-broker</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Red Hat AMQ Broker operator</p>
</li>
<li>
<p>Kafka cluster named my-cluster</p>
</li>
<li>
<p>AMQ broker cluster and ActiveMQArtemisAddress (webhook-address,wehook-dlq)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="literalblock">
<div class="content">
<pre>webhook-system-kafka</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Red Hat Streams for Apache Kafka operator</p>
</li>
<li>
<p>Kafka cluster named my-cluster</p>
</li>
<li>
<p>Kafka topic named order-created-event</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="literalblock">
<div class="content">
<pre>webhook-system-data-grid</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Red Hat DataGrid operator</p>
</li>
<li>
<p>Infinispan cluster named my-infinispan</p>
</li>
<li>
<p>Infinispan caches (3scale-consumer-applications,webhook-creator-idempotency)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="literalblock">
<div class="content">
<pre>openshift-keda</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Red Hat Custom Metrics Autoscaler operator</p>
</li>
<li>
<p>KedaController instance</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="literalblock">
<div class="content">
<pre>webhook-system</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>webhook Camel Quarkus Components (webhook-creator,webhook-dispatcher,camel-proxy,order-event-simulator)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="literalblock">
<div class="content">
<pre>webhook-system-shipping-consumer</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Camel Quarkus Integration for consumer webhook of Globex shipping partner</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/enviroment.gif" alt="enviroment" width="100%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_as_an_api_provider"><a class="anchor" href="#_as_an_api_provider"></a><a class="link" href="#_as_an_api_provider">2.2. As an API provider</a></h3>
<div class="paragraph">
<p>The installation script uses 3scale operator cabaility to create "Order-Created-Event" product artifacts (backend,mapping rules,policy configuration,application plans,ActiveDocs) ,</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <a href="https://webhook-apis-admin.%SUBDOMAIN%" target="admin-portal">admin portal</a> and sign in using admin/admin</p>
</li>
<li>
<p>Click on "Order-Created_Event" product in the dashboard page</p>
</li>
<li>
<p>Review the structure of the event driven product as in the below animated screenshots</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/admin-portal.gif" alt="admin portal" width="100%">
</div>
</div>
<div class="paragraph">
<p>Webhook delivery system components</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/webhook-system-components.jpg" alt="webhook system components" width="50%">
</div>
</div>
<div class="paragraph">
<p>In the openshift console topology view select project webhook-system has below 4 deployments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Webhook-creator</strong>: Camel Quarkus implementation to the webhook creator service.</p>
</li>
<li>
<p><strong>Webhook-dispatcher</strong>: Camel Quarkus implementation to the Webhook dispatcher service</p>
</li>
<li>
<p><strong>Camel-proxy</strong>: Camel Quarkus implementation to 3scale custom policy using Camel service policy that implements HMAC policy and provides dynamic routing to the webhook endpoint.</p>
</li>
<li>
<p><strong>Order-event-simulator</strong>: Camel Quarkus service that produces order-created events in Kafka topic based on received input HTTP JSON message.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The webhook-creator and dispatcher services are <strong>scaled to zero</strong> (no pods are running) as KEDA rules are configured using ScaledObject CRD with a scale-to-zero strategy when no messages in the Kafka topic or AMQ Broker Queue.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The source code for the webhook system components can be found in this <a href="https://github.com/rh-soln-pattern-event-driven-api/integration" target="_blank" rel="noopener">repository</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_as_an_api_consumer"><a class="anchor" href="#_as_an_api_consumer"></a><a class="link" href="#_as_an_api_consumer">2.3. As an API Consumer</a></h3>
<div class="paragraph">
<p>As Globex&#8217;s shipping partner, I need to create a consumer application for the Order-Created-Event product through the developer portal to register my webhook endpoint to start receiving notifications for newly created orders to integrate it with the internal shipping process. Follow the below steps to update the pre-build created application:-</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <a href="https://webhook-apis.%SUBDOMAIN%" target="console">developer portal</a> and sign in using john/123456</p>
</li>
<li>
<p>Click on shipping-unlimited-application</p>
</li>
<li>
<p>Copy the generated MAC Secret into the clipboard and click on the Edit link in the right corner "Edit shipping-unlimited-application"</p>
</li>
<li>
<p>Edit the Webhook URL text box with this URL <a href="https://webhook-consumer-shipping-webhook-system-shipping-consumer.%SUBDOMAIN%" class="bare">https://webhook-consumer-shipping-webhook-system-shipping-consumer.%SUBDOMAIN%</a> and click on the Update Application button</p>
</li>
<li>
<p>In the Openshift console topology view inside webhook-system-shipping-consumer project, click on Edit Deployment</p>
</li>
<li>
<p>Edit the environment variable named "macSecret" with the copied value and click on the Save button</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/consumer.gif" alt="consumer" width="100%">
</div>
</div>
<div class="paragraph">
<p>API consumers can see the structure of the data that will be sent to the provided webhook endpoint through the API documentation section in the developer portal, this includes detailed schemas for the JSON or XML payloads with examples, security specifications, and response codes. This will allow developers to prepare their endpoints to correctly parse and utilize the incoming data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/schema.jpg" alt="schema" width="50%" height="50%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_solution"><a class="anchor" href="#_testing_the_solution"></a><a class="link" href="#_testing_the_solution">2.4. Testing the solution</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Review is the content sample of order.json which will be used as testing data for one below order</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
   "orderId": "1001XYZ",
    "name": "John Doe",
    "email": "johndoe@example.com",
    "status": "ORDER_CREATED",
    "accountId": "200345",
    "createdAt": 1691797320000
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.Use curl to send HTTP request to the simulator service which will post the testing order to the Kafka topic</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-adoc hljs" data-lang="adoc">curl -X POST  -H "Content-Type: application/json" -d @webhook-system/order.json https://order-event-simulator-webhook-system.%SUBDOMAIN%</code></pre>
</div>
</div>
<div class="paragraph">
<p>The curl command will print the below message in the terminal</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Request received</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the logs of the <strong>webhook-consumer-shipping</strong> pod, and notice that the pod received the webhook successfully.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/webhook-completed.jpg" alt="webhook completed" width="70%">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Since the Webhook Creator service features idempotent processing, repeating the same cURL command within the configured timeout period of the DataGrid cache (10 minutes) will not result in duplicate messages. The screenshot below displays the DataGrid console showing the cache entries.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/idempotent.jpg" alt="idempotent" width="70%">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit the statistics page in the developer portal and notice the chart shows one hit to the webhook endpoint.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/dev-portal-statistics.jpg" alt="dev portal statistics" width="70%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_scalability"><a class="anchor" href="#_testing_the_scalability"></a><a class="link" href="#_testing_the_scalability">2.5. Testing the scalability</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Review is the content sample of orders.json which has more than 40 orders</p>
</li>
<li>
<p>Use curl to send HTTP request to the simulator service which will post the testing order to the Kafka topic</p>
</li>
</ol>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-adoc hljs" data-lang="adoc">curl -X POST  -H "Content-Type: application/json" -d @webhook-system/orders.json https://order-event-simulator-webhook-system.%SUBDOMAIN%</code></pre>
</div>
</div>
<div class="paragraph">
<p>The curl command will print the below message in the terminal</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Request received</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the number of scaled pods for webhook-creator and webhook-dispatcher pods in the topology view</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/scalability-testing.jpg" alt="scalability testing" width="70%">
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use oc get pods with the watch command to see the scaling up/down of pods as below</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-adoc hljs" data-lang="adoc">oc get pods -n webhook-system -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>After all, messages are consumed, there will be no messages left on the Kafka topic or in the AMQ Broker queue. KEDA waits for the cooldown period (in this demo 40 seconds) and then scales down the deployment to zero.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a><a class="link" href="#_conclusion">3. Conclusion</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here are the key takeaways from the event-driven API management solution pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Today&#8217;s modern application architectures require more than the traditional request-response patterns of REST APIs for  facilitating real-time communication and events, webhooks have become the predominant API pattern for handling asynchronous interactions.</p>
</li>
<li>
<p>Red Hat Application Foundations provides flexible architecture choices for building a scalable webhook delivery system, allowing you to select the right component for the job.</p>
</li>
<li>
<p>Developers can discover, access documentation, and subscribe to event-driven API products through the 3scale developer portal just like traditional REST APIs.</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="02-architecture.html" class="query-params-link">2. Architecture</a></span>
  <span class="next"><a href="developer-resources.html" class="query-params-link">4. Developer Resources</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer" style="justify-content: center;">
  <div>
    <img src="./_images/red_hat_logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns" href="https://redhat.com">
  </div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
